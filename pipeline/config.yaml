# Respiratory Analysis Pipeline Configuration

# ============================================================================
# 1. DATA CONFIGURATION
# ============================================================================
data:
  # Paths
  data_dir: 'C:/Users/omris/OneDrive/Desktop/Sleeping Lab/DoC respiration data/downsampled'
  labels_file: 'C:/Users/omris/OneDrive/Desktop/Sleeping Lab/DoC respiration data/respiratory_analysis_all_subjects.xlsx'
  output_dir: 'C:/Users/omris/OneDrive/Desktop/Sleeping Lab/DoC respiration data/results_experiment_1'

  # Columns Setup (Updated based on your debug output)
  subject_id_column: "Name"

  # Target Outcomes (Updated to match Excel headers exactly)
  outcomes:
    - "Recovery"
    - "currentConsciousness"            # Replaced "MCS_vs_UWS"
    - "Survival"

  positive_class: 1                     # Target class value (e.g. 1)

  # Loading parameters
  data_key: 'data'
  fs_key: 'fs'
  default_sampling_rate: 6.0

  # Recording Length Experiments (in minutes)
  # Set to [null] to use full recordings only
  # Set to [5, 10, 15, 20, null] to test multiple lengths
  recording_lengths: [5, 10, 15, 20, null]  # null = use full recording

# ============================================================================
# 2. PREPROCESSING
# ============================================================================
preprocessing:
  cleaning:
    remove_outliers: true
    apply_filter: true
    filter_type: 'bandpass'           # 'bandpass', 'lowpass', 'highpass'
    lowcut: 0.05                      # Hz - lower cutoff frequency
    highcut: 0.5                      # Hz - upper cutoff frequency
    filter_order: 4                   # Filter order for Butterworth filter
    detrend: 'linear'                 # 'linear', 'constant', or null for no detrending

  windowing:
    window_size: 300       # 5 minutes
    overlap: 60            # 1 minute overlap

# ============================================================================
# 2.5 DATA QUALITY CHECKS
# ============================================================================
data_quality:
  enabled: true                       # Enable quality checking
  gap_threshold: 0.0                  # Threshold for detecting gaps (values at/below this)
  min_gap_duration_sec: 1.0           # Minimum gap duration to flag (seconds)
  flat_threshold: 0.001               # Threshold for detecting flat regions (std dev)
  min_flat_duration_sec: 5.0          # Minimum flat duration to flag (seconds)
  outlier_threshold_std: 10.0         # Number of std deviations for outlier detection
  physiological_min: -100.0           # Minimum physiologically plausible value
  physiological_max: 100.0            # Maximum physiologically plausible value
  min_valid_percent: 80.0             # Minimum % of valid data required
  reject_threshold: 50.0              # Reject if valid% below this
  auto_clean: true                    # Automatically clean detected issues

# ============================================================================
# 3. FEATURE EXTRACTION
# ============================================================================
features:
  peak_detection:
    min_peak_distance_seconds: 2.0
    min_peak_prominence: 0.01

  aggregation:
    functions: ['mean']  # Changed from ['mean', 'std', 'cv'] to avoid feature duplication
    min_windows: 1

# ============================================================================
# 4. ANALYSIS LAYER
# ============================================================================
analysis:
  statistical:
    test: 'mannwhitney'         # 'mannwhitney' or 'ttest'
    alpha: 0.05                 # Significance threshold
    correction: 'fdr_bh'        # 'fdr_bh' (Benjamini-Hochberg) or 'bonferroni'

  feature_selection:
    method: 'statistical'       # Select features based on p-value
    n_features: 20              # Max features to select for modelling

# ============================================================================
# 5. MODELS LAYER
# ============================================================================
models:
  # General Settings
  cv_folds: 5                   # Cross-validation folds for tuning
  bootstrap_iterations: 100     # Number of bootstrap resamples for CI

  # Leave-One-Subject-Out (LOSO) Cross-Validation
  loso:
    enabled: true               # Enable LOSO CV (patient-level cross-validation)
    top_n_features: 6           # Number of top significant features to use in first experiment

  # Leave-One-Recording-Out (LORO) Cross-Validation
  loro:
    enabled: true               # Enable LORO CV (recording-level CV with participant exclusion)

  # Neural Network Architecture
  neural_network:
    enabled: false              # Enable Neural Network training (default: false due to small dataset)
    hidden_layers: [100, 50]    # Two hidden layers
    activation: 'relu'
    max_iter: 500
    solver: 'adam'

  # Grid Search Spaces
  tuning:
    svm:
      C: [0.1, 1, 10, 100]
      kernel: ['rbf', 'linear']
    random_forest:
      n_estimators: [50, 100, 200]
      max_depth: [null, 10, 20]

# ============================================================================
# 6. VISUALIZATION & EXPORT
# ============================================================================
visualization:
  generate_plots: true
  dashboard_filename: "DASHBOARD_SUMMARY.html"
  max_signal_plots: 10  # Only create breathmetrics plots for first N recordings (speeds up processing)
  force_regenerate_signals: false  # Set to true to regenerate signal plots even if they exist

export:
  filename: "FINAL_REPORT.xlsx"
  include_hyperparameters: true